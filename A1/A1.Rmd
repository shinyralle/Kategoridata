---
title: "A1"
author: "Magnus Brogie, Rahul Duggal"
date: "12 November 2018"
output: github_document
---



# Assignment 1
## 1. Hur många percent av män respektive kvinnor är för och emot laglig abort?

```{r }
library(tidyverse)
# install.packages("kableExtra")
cont_table = matrix(
  c(309, 191, 319, 281), # the data elements 
  nrow=2,              # number of rows 
  ncol=2,              # number of columns 
  byrow = TRUE)  # fill matrix by rows 
cont_table

women_men = rowSums(cont_table)
favor_against = colSums(cont_table)
total = sum(cont_table)

# Calculates percentages by matrix multiplication
(percentages_matrix <- diag(1 / women_men) %*% cont_table) * 100
colnames(percentages_matrix) <- c("In Favor", "Against")
rownames(percentages_matrix) <- c("Women", "Men")
percentages_matrix #  %>% knitr::kable()

expected_matrix <- total * (diag(1 / women_men)  %*% cont_table) * (cont_table %*% diag(1 / favor_against))
expected_matrix
cont_table
cont_minus_expected <- cont_table - expected_matrix
cont_minus_expected_squared  <- cont_minus_expected * cont_minus_expected
test_matrix <- cont_minus_expected_squared / expected_matrix
chi_two_statistic <- sum(test_matrix)
chi_two_statistic 



```

Procent anger antal hundradelar och noteras med %. Vi kan beräkna hur många procent $kn$ är av $m$ genom att ställa upp $100 \times n/m$. Detta fungerar eftersom vår siffersystem är decimalt. Således blir andelen kvinnor som är för laglig abort i procent $$100 \times \frac{\text{antal kvinnor för laglig abort}}{\text{totalt antal kvinnor}}$$ och andelen kvinnor som är emot laglig abort i procent $$100 \times \frac{\text{antal kvinnor mot laglig abort}}{\text{totalt antal kvinnor}}$$, och motsvarande för män. Dessa beräknar ger oss följande tabell med procent:   `

```{r}
(100 * percentages_matrix) %>% knitr::kable()
```


$$
\begin{aligned} 
G^{2} &= 2 \sum_{i} \sum_{j} \text{ observed } \times \ln \left( \frac{\text{observed}}{\text{expected}} \right)\\
&=2n \sum_{i} \sum_{j}  \widehat{p}_{ij} \ln \left( \frac{\widehat{p}_{ij}}{p_{ij}} \right)
\end{aligned}
$$


```{r geetwo}
cont_table = matrix(
  c(309, 191, 319, 281), # the data elements 
  nrow=2,              # number of rows 
  ncol=2,              # number of columns 
  byrow = TRUE)  # fill matrix by rows 
cont_table

women_men = rowSums(cont_table)
women_men
diag(1 / women_men)
favor_against = colSums(cont_table)
favor_against
total = sum(cont_table)

(percentages_matrix <- diag(1 / women_men) %*% cont_table) * 100
colnames(percentages_matrix) <- c("In Favor", "Against")
rownames(percentages_matrix) <- c("Women", "Men")
percentages_matrix #  %>% knitr::kable()

expected_matrix <- total *  ((women_men / total)) %*%  t((favor_against / total))

# shift.column(diag((favor_against / total)))

(diag(1 / women_men)  %*% cont_table) 
(cont_table %*% diag(1 / favor_against))

total * (cont_table %*% diag(1 / favor_against)) * (diag(1 / women_men)  %*% cont_table)

expected_matrix
cont_table
sum(expected_matrix)
obs_divided_by_expected <- cont_table / expected_matrix
obs_divided_by_expected
sapply(obs_divided_by_expected, log)
 matrix(sapply(obs_divided_by_expected, log), nrow = 2)
log_obs_divided_by_expected <-  matrix(sapply(obs_divided_by_expected, log), nrow = 2)
log_obs_divided_by_expected 
obs_mult_by_log_obs_divided_by_expected <- cont_table * log_obs_divided_by_expected
obs_mult_by_log_obs_divided_by_expected
gee_two <- 2 * sum(obs_mult_by_log_obs_divided_by_expected)
gee_two
309*log(309/((628/1100)*(500/1100)*1100)) +
191*log(191/((472/1100)*(500/1100)*1100)) +
319*log(319/((628/1100)*(600/1100)*1100)) +
281*log(281/((472/1100)*(600/1100)*1100)) 

(309/628)*(309/500)*1100

# f(x) <- function()



```


## 2.
Skiljer värdena i tabellen sig signifikant från de som skulle förväntas ifall att kön och att vara för eller emot laglig abort vore oberoende?  Vi vill testa 
$$
\begin{aligned}
H_{0}: & \text{ den förklaranden variabeln är oberoende av responsvariablen } \Leftrightarrow \\
       &\pi_{ij} = \pi_{i\circ}\pi_{\circ j} \text{ för alla $i$ och $j$}
\end{aligned}
$$

Persons $X^{2}$ statiska kan användas för att testa en hypotetisk fördelning i en kontingenstabell. Den är $\chi^{2}(f!!)$ FIXA! fördelad och beräknas enligt följande

$$
\begin{aligned}
\chi^{2} &= \sum_{i} \sum_{j}  \frac{(\text{observed} - \text{expected})^{2}}{\text{expected}}\\
         &= \sum_{i} \sum_{j}  \frac{(x_{ij} - e_{ij})^{2}}{e_{ij}}
\end{aligned}
$$

där "expected", "$e_{ij}$",  är de förväntade värdena i kontingenstabellen på rad $i$ och kolumn $j$ under hypotesen och "observed", "$x_{ij}$", är motsvarande observerade värde i kontingenstabellen.

Under antagandet att antal som är för respektive emot laglig abort är oberoende av 
kön gäller att
$$
\pi_{ij} = \pi_{i\circ}\pi_{\circ j}
$$
där $\pi_{ij}$ anger sannoliketen att en observation hamnar på rad $i$ och kolumn $j$,  $\pi_{i\circ}$ anger sannolikheten att en observation hamnar på rad $i$ och $\pi_{\circ j}$ anger sannolikheten att en observation hamnar på kolumn $j$. Sannolikheten $\pi_{ij}$ kan skattas med hjälp av observationera i kontingens tabellen på följande vis $$\widehat{\pi}_{ij} = \frac{n_{ij}}{n_{tot}}$$, där $\n_{tot}$ anger det totala antalet observationer. Vi kan även skatta sannolikheten att en observation hamnar i rad $i$ med $\widehat{\pi}_{i\circ} =  \frac{n_{i+}}{n_{tot}}$, där $n_{i+}$ anger summan av alla observationer på rad $i$ och $n_{+j}$ motsvarande för kolumn $j$. Det ger oss att under nollhypotesen följande skattningar av de förväntade värdena $\widehat{e}_{ij} = n\widehat{\pi}_{i\circ}\widehat{\pi}_{\circ j}$. Dessa uträkningar ger oss vår chitvå statiska med HUR MÅNGA FRIHETSGRADER `r chi_two_statistic` som vi kan jämföra med en tabell.  

```{r hupp}
library(tidyverse)
# install.packages("kableExtra")
cont_table = matrix(
  c(309, 191, 319, 281), # the data elements 
  nrow=2,              # number of rows 
  ncol=2,              # number of columns 
  byrow = TRUE)  # fill matrix by rows 
cont_table

women_men = rowSums(cont_table)
favor_against = colSums(cont_table)
total = sum(cont_table)


# mapply(cont_table, f())
```



$$
\begin{aligned} 
G^{2} &= 2 \sum_{i} \sum_{j} \text{ observed } \times \ln \left( \frac{\text{observed}}{\text{expected}} \right)\\
&=2n \sum_{i} \sum_{j}  \widehat{p}_{ij} \ln \left( \frac{\widehat{p}_{ij}}{p_{ij}} \right)
\end{aligned}
$$



## 3.
Vi vill ställa upp odds-kvoten 


## 4.


## 5.

```{r cars}
summary(cars)
```



## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

