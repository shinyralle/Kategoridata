A1
================
Magnus Brogie, Rahul Duggal
12 November 2018

# Assignment 1

## 1\. Hur många percent av män respektive kvinnor är för och emot laglig abort?

``` r
library(tidyverse)
```

    ## -- Attaching packages ---------------------------------- tidyverse 1.2.1 --

    ## v ggplot2 3.1.0     v purrr   0.2.5
    ## v tibble  1.4.2     v dplyr   0.7.7
    ## v tidyr   0.8.2     v stringr 1.3.1
    ## v readr   1.1.1     v forcats 0.3.0

    ## -- Conflicts ------------------------------------- tidyverse_conflicts() --
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

``` r
# install.packages("kableExtra")
cont_table = matrix(
  c(309, 191, 319, 281), # the data elements 
  nrow=2,              # number of rows 
  ncol=2,              # number of columns 
  byrow = TRUE)  # fill matrix by rows 
cont_table
```

    ##      [,1] [,2]
    ## [1,]  309  191
    ## [2,]  319  281

``` r
women_men = rowSums(cont_table)
favor_against = colSums(cont_table)
total = sum(cont_table)

# Calculates percentages by matrix multiplication
(percentages_matrix <- diag(1 / women_men) %*% cont_table) * 100
```

    ##          [,1]     [,2]
    ## [1,] 61.80000 38.20000
    ## [2,] 53.16667 46.83333

``` r
colnames(percentages_matrix) <- c("In Favor", "Against")
rownames(percentages_matrix) <- c("Women", "Men")
percentages_matrix #  %>% knitr::kable()
```

    ##        In Favor   Against
    ## Women 0.6180000 0.3820000
    ## Men   0.5316667 0.4683333

``` r
expected_matrix <- total * (diag(1 / women_men)  %*% cont_table) * (cont_table %*% diag(1 / favor_against))
expected_matrix
```

    ##          [,1]     [,2]
    ## [1,] 334.4876 170.0386
    ## [2,] 297.0730 306.6988

``` r
cont_table
```

    ##      [,1] [,2]
    ## [1,]  309  191
    ## [2,]  319  281

``` r
cont_minus_expected <- cont_table - expected_matrix
cont_minus_expected_squared  <- cont_minus_expected * cont_minus_expected
test_matrix <- cont_minus_expected_squared / expected_matrix
chi_two_statistic <- sum(test_matrix)
chi_two_statistic 
```

    ## [1] 8.297921

Procent anger antal hundradelar och noteras med %. Vi kan beräkna hur
många procent \(kn\) är av \(m\) genom att ställa upp
\(100 \times n/m\). Detta fungerar eftersom vår siffersystem är
decimalt. Således blir andelen kvinnor som är för laglig abort i procent
\[100 \times \frac{\text{antal kvinnor för laglig abort}}{\text{totalt antal kvinnor}}\]
och andelen kvinnor som är emot laglig abort i procent
\[100 \times \frac{\text{antal kvinnor mot laglig abort}}{\text{totalt antal kvinnor}}\],
och motsvarande för män. Dessa beräknar ger oss följande tabell med
procent: \`

``` r
(100 * percentages_matrix) %>% knitr::kable()
```

|       | In Favor |  Against |
| ----- | -------: | -------: |
| Women | 61.80000 | 38.20000 |
| Men   | 53.16667 | 46.83333 |

\[
\begin{aligned} 
G^{2} &= 2 \sum_{i} \sum_{j} \text{ observed } \times \ln \left( \frac{\text{observed}}{\text{expected}} \right)\\
&=2n \sum_{i} \sum_{j}  \widehat{p}_{ij} \ln \left( \frac{\widehat{p}_{ij}}{p_{ij}} \right)
\end{aligned}
\]

``` r
cont_table = matrix(
  c(309, 191, 319, 281), # the data elements 
  nrow=2,              # number of rows 
  ncol=2,              # number of columns 
  byrow = TRUE)  # fill matrix by rows 
cont_table
```

    ##      [,1] [,2]
    ## [1,]  309  191
    ## [2,]  319  281

``` r
women_men = rowSums(cont_table)
women_men
```

    ## [1] 500 600

``` r
diag(1 / women_men)
```

    ##       [,1]        [,2]
    ## [1,] 0.002 0.000000000
    ## [2,] 0.000 0.001666667

``` r
favor_against = colSums(cont_table)
favor_against
```

    ## [1] 628 472

``` r
total = sum(cont_table)

(percentages_matrix <- diag(1 / women_men) %*% cont_table) * 100
```

    ##          [,1]     [,2]
    ## [1,] 61.80000 38.20000
    ## [2,] 53.16667 46.83333

``` r
colnames(percentages_matrix) <- c("In Favor", "Against")
rownames(percentages_matrix) <- c("Women", "Men")
percentages_matrix #  %>% knitr::kable()
```

    ##        In Favor   Against
    ## Women 0.6180000 0.3820000
    ## Men   0.5316667 0.4683333

``` r
expected_matrix <- total *  ((women_men / total)) %*%  t((favor_against / total))

# shift.column(diag((favor_against / total)))

(diag(1 / women_men)  %*% cont_table) 
```

    ##           [,1]      [,2]
    ## [1,] 0.6180000 0.3820000
    ## [2,] 0.5316667 0.4683333

``` r
(cont_table %*% diag(1 / favor_against))
```

    ##           [,1]     [,2]
    ## [1,] 0.4920382 0.404661
    ## [2,] 0.5079618 0.595339

``` r
total * (cont_table %*% diag(1 / favor_against)) * (diag(1 / women_men)  %*% cont_table)
```

    ##          [,1]     [,2]
    ## [1,] 334.4876 170.0386
    ## [2,] 297.0730 306.6988

``` r
expected_matrix
```

    ##          [,1]     [,2]
    ## [1,] 285.4545 214.5455
    ## [2,] 342.5455 257.4545

``` r
cont_table
```

    ##      [,1] [,2]
    ## [1,]  309  191
    ## [2,]  319  281

``` r
sum(expected_matrix)
```

    ## [1] 1100

``` r
obs_divided_by_expected <- cont_table / expected_matrix
obs_divided_by_expected
```

    ##           [,1]      [,2]
    ## [1,] 1.0824841 0.8902542
    ## [2,] 0.9312633 1.0914548

``` r
sapply(obs_divided_by_expected, log)
```

    ## [1]  0.07925847 -0.07121326 -0.11624820  0.08751149

``` r
matrix(sapply(obs_divided_by_expected, log), nrow = 2)
```

    ##             [,1]        [,2]
    ## [1,]  0.07925847 -0.11624820
    ## [2,] -0.07121326  0.08751149

``` r
log_obs_divided_by_expected <-  matrix(sapply(obs_divided_by_expected, log), nrow = 2)
log_obs_divided_by_expected 
```

    ##             [,1]        [,2]
    ## [1,]  0.07925847 -0.11624820
    ## [2,] -0.07121326  0.08751149

``` r
obs_mult_by_log_obs_divided_by_expected <- cont_table * log_obs_divided_by_expected
obs_mult_by_log_obs_divided_by_expected
```

    ##           [,1]      [,2]
    ## [1,]  24.49087 -22.20341
    ## [2,] -22.71703  24.59073

``` r
gee_two <- 2 * sum(obs_mult_by_log_obs_divided_by_expected)
gee_two <- 2 * (309*log(309/((628/1100)*(500/1100)*1100)) +
191*log(191/((472/1100)*(500/1100)*1100)) +
319*log(319/((628/1100)*(600/1100)*1100)) +
281*log(281/((472/1100)*(600/1100)*1100)))


(309/628)*(309/500)*1100
```

    ## [1] 334.4876

``` r
# f(x) <- function()
```

## 2\.

Skiljer värdena i tabellen sig signifikant från de som skulle förväntas
ifall att kön och att vara för eller emot laglig abort vore oberoende?
Vi vill testa \[
\begin{aligned}
H_{0}: & \text{ den förklaranden variabeln är oberoende av responsvariablen } \Leftrightarrow \\
       &\pi_{ij} = \pi_{i\circ}\pi_{\circ j} \text{ för alla $i$ och $j$}
\end{aligned}
\]

Persons \(X^{2}\) statiska kan användas för att testa en hypotetisk
fördelning i en kontingenstabell. Den är \(\chi^{2}(f!!)\) FIXA\!
fördelad och beräknas enligt följande

\[
\begin{aligned}
\chi^{2} &= \sum_{i} \sum_{j}  \frac{(\text{observed} - \text{expected})^{2}}{\text{expected}}\\
         &= \sum_{i} \sum_{j}  \frac{(x_{ij} - e_{ij})^{2}}{e_{ij}}
\end{aligned}
\]

där “expected”, “\(e_{ij}\)”, är de förväntade värdena i
kontingenstabellen på rad \(i\) och kolumn \(j\) under hypotesen och
“observed”, “\(x_{ij}\)”, är motsvarande observerade värde i
kontingenstabellen.

Under antagandet att antal som är för respektive emot laglig abort är
oberoende av kön gäller att \[
\pi_{ij} = \pi_{i\circ}\pi_{\circ j}
\] där \(\pi_{ij}\) anger sannoliketen att en observation hamnar på rad
\(i\) och kolumn \(j\), \(\pi_{i\circ}\) anger sannolikheten att en
observation hamnar på rad \(i\) och \(\pi_{\circ j}\) anger
sannolikheten att en observation hamnar på kolumn \(j\). Sannolikheten
\(\pi_{ij}\) kan skattas med hjälp av observationera i kontingens
tabellen på följande vis
\[\widehat{\pi}_{ij} = \frac{n_{ij}}{n_{tot}}\], där \(\n_{tot}\) anger
det totala antalet observationer. Vi kan även skatta sannolikheten att
en observation hamnar i rad \(i\) med
\(\widehat{\pi}_{i\circ} = \frac{n_{i+}}{n_{tot}}\), där \(n_{i+}\)
anger summan av alla observationer på rad \(i\) och \(n_{+j}\)
motsvarande för kolumn \(j\). Det ger oss att under nollhypotesen
följande skattningar av de förväntade värdena
\(\widehat{e}_{ij} = n\widehat{\pi}_{i\circ}\widehat{\pi}_{\circ j}\).
Dessa uträkningar ger oss vår chitvå statiska med HUR MÅNGA
FRIHETSGRADER 8.2979214 som vi kan jämföra med en tabell.

``` r
library(tidyverse)
# install.packages("kableExtra")
n11 <- 309
n12 <- 191
n21 <- 319
n22 <- 281

cont_table = matrix(
  c(309, 191, 319, 281), # the data elements 
  nrow=2,              # number of rows 
  ncol=2,              # number of columns 
  byrow = TRUE)  # fill matrix by rows 
cont_table
```

    ##      [,1] [,2]
    ## [1,]  309  191
    ## [2,]  319  281

``` r
women_men = rowSums(cont_table)
favor_against = colSums(cont_table)
total = sum(cont_table)

stickprovsoddskvot <- (n22 * n11)/(n12 * n21)


# mapply(cont_table, f())
```

\[
\begin{aligned} 
G^{2} &= 2 \sum_{i} \sum_{j} \text{ observed } \times \ln \left( \frac{\text{observed}}{\text{expected}} \right)\\
&=2n \sum_{i} \sum_{j}  \widehat{p}_{ij} \ln \left( \frac{\widehat{p}_{ij}}{p_{ij}} \right)
\end{aligned}
\]

## 3\.

Vi vill med hjälp av de observerade värdena estimera den odds-kvot som
anger hur många gånger större oddsen att en man är emot laglig abort,
denoterad \(\Omega_{m}\), än oddsen att en kvinna är det, denoterad
\(\Omega_{k}\). Det vill säga vi vill estimera oddskvoten

\[ \begin{aligned} 
\text{ oddskvot } &= \frac{\Omega_{m}}{\Omega_{k}} \\ 
&= \frac{\text{ odds att en man är emot laglig abort }}{ \text{ odds att en kvinna är emot laglig abort }}\\ 
&= \frac{\text{ (sannolikheten att en man är emot laglig abort)/(sannolikheten att en man är för laglig abort) }}{ \text{ (sannolikheten att en kvinna är emot laglig abort)/(sannolikheten att en kvinna är för laglig abort) }}\\
&= \frac{\pi_{j = 2| i = 2}/(1-\pi_{j = 2| i = 2})}{\pi_{j = 2 | i = 1}/(1-\pi_{j = 2 | i = 1})}
\end{aligned}\] med stickprovsoddskvoten

\[ \begin{aligned} 
\text{ stickprovsoddskvot } &= \frac{\text{ stickprovsodds att en man är emot laglig abort }}{ \text{ stickprovsodds att en kvinna är emot laglig abort }}\\ &=\frac{\widehat{\Omega}_{m}}{\widehat{\Omega}_{k}}\\
&= \frac{\text{ (stickprovssannolikheten att en man är emot laglig abort)/(stickprovssannolikheten att en man är för laglig abort) }}{ \text{ (stickprovssannolikheten att en kvinna är emot laglig abort)/(stickprovssannolikheten att en kvinna är för laglig abort) }}\\
&= \frac{\widehat{\pi}_{j = 2| i = 2}/(1-\widehat{\pi}_{j = 2| i = 2})}{\widehat{\pi}_{j = 1 | i = 2}/(1-\widehat{\pi}_{j = 1 | i = 2})}\\
&= \frac{(n_{22}/n_{2+})/(n_{21}/n_{2+})}{(n_{12}/n_{1+})/(n_{11}/n_{1+})}\\
&= \frac{n_{22}n_{11}}{n_{12}n_{21}}
\end{aligned}\]

Gör vi dessa uträkningar så får vi stickprovsoddskvoten 1.4250849. Med
andra ord är vårt estimat är oddset att en man är emot laglig abort
1.4250849 så högt som oddset att en kvinna är det. Under antagande att
enkätdatan är multinomialfördelad gäller att standardefelet för
oddskvoten kan estimeras
med

\[ \widehat{\sigma}(\log (\text{stickprovsoddskvot})) = \sqrt{\left(\frac{1}{n_{11}} + \frac{1}{n_{12}} + \frac{1}{n_{21}} + \frac{1}{n_{12}}\right)}\]

Se ekvation 3.1 på sid 70 i kurslitteraturen. Vidare, gäller per
normaliteten av \(\log \widehat{\theta}\) för stora stickprov,
att

\[ \log \widehat{\theta} \pm z_{0.025} \widehat{\sigma}(\log \widehat{\theta}).\]
ger oss ett konfidensintervall med konfidensgrad \(0.05\). Se sid. 71 i
kurslitteraturen, och vi kan exponentiera ändpunkterna av detta
intervall för att få ett konfidensintervall för \[\widehat{\theta}\].
När vi genomför beräkningarna enligt ovan får vi att

``` r
se_logstickprovsoddskvot = sqrt((1/n11)+(1/n12)+(1/n21)+(1/n22)) 

qnorm(0.975)
```

    ## [1] 1.959964

``` r
hoger_andpunkt <- exp(log(stickprovsoddskvot) + qnorm(0.975) * se_logstickprovsoddskvot)
vanster_andpunkt <- exp(log(stickprovsoddskvot) + qnorm(0.025) * se_logstickprovsoddskvot)
stickprovsoddskvot
```

    ## [1] 1.425085

standardfelet för
\(\widehat{\sigma}(\text{stickprovsoddskvot}) = 1.425085\) och att
konfidensintervallet för blir (1.1194823,1.8141128).

## 4\.

Vi vill estimera hur många gånger större sannolikheten är att en man är
emot laglig abort än att en kvinna är emot laglig abort. Det vill säga
vi vill estimera riskkvoten, vilken är kvoten mellan sannoliketen att en
man är emot laglig abort och sannolikheten att en kvinna är emot laglig
abort. Denna ges av

\[
\text{ riskkvot } = \frac{\pi_{j = 2|i = 2}}{\pi_{j = 2|i = 1}}
\] där \(i\) är radindex och \(j\) kolumn index. Denna estimerar vi med

\[
\begin{aligned}
\text{ stickprovsriskkvot } &= \frac{\widehat{\pi}_{j = 2|i = 2}}{\widehat{\pi}_{j = 2|i = 1}}\\
&= \frac{(n_{22}/n_{2+})}{(n_{12}/n_{1+})}
\end{aligned}
\]

``` r
stickprovsriskkvot <- (n22/ women_men[2])/(n12 / women_men[1])
women_men[2]
```

    ## [1] 600

``` r
n22
```

    ## [1] 281

och när vi räknar ut denna får vi att den blir 1.2260035. Vi räknar med
hjälp av formeln 3.5 på sida 71 ut standradfelet för
stickprovsriskkvoten, nedan:

\[
\begin{aligned}
\widehat{\sigma}\left(
\log \left(
\frac{\widehat{\pi}_{j = 2|i = 2}}{\widehat{\pi}_{j = 2|i = 1}}
\right) 
\right) &= \sqrt{
\frac{1 - \widehat{\pi}_{j = 2|i = 2}}{n_{22}} + \frac{1 - \widehat{\pi}_{j = 2|i = 1}}{n_{12}}
}\\
&= \sqrt{
\frac{1 - n_{22}/n_{2+} }{n_{22}} + \frac{1 - n_{12}/n_{1+}}{n_{12}}
}
\end{aligned}
\]

``` r
se_log_stickprovsriskkvot <- sqrt(((1 - (n22/ women_men[2]))/ women_men[2]) + ((1 - (n12 / women_men[1]))/ women_men[1]))
```

och räknar vi ut denna genom att mata in värden så blir det 0.0460664.
Med andra ord är vårt estimat att män är 0.0460664 så sannolika att vara
emot laglig abort som kvinnor. Vi kan sedan skapa konfidensintervallet
för stickprovssriskkvoten med hjälp av formeln för ändamålet på sid 71
i kurslitteraturen

\[
\log \left(
\frac{
\widehat{\pi}_{j = 2|i = 2}}{
\widehat{\pi}_{j = 2|i = 1}}
\right)
\pm z_{0.025}\widehat{\sigma}
\left(
\log \left(
\frac{
\widehat{\pi}_{j = 2|i = 2}}{\widehat{\pi}_{j = 2|i = 1}}
\right)
\right)
\].

Det vill säga

\[
\log \left(
\frac{
n_{22}/ n_{2+} }{
n_{12} / n_{1+}}
\right)
\pm z_{0.025}\sqrt{
\frac{1 - n_{22}/n_{2+} }{n_{22}} + \frac{1 - n_{12}/n_{1+}}{n_{12}}
}
\]. Vilket ger oss konfidensintervallet

``` r
vanster_andpunkt2 <- exp(
  log((n22/ women_men[2])/(n12 / women_men[1])) + qnorm(0.025)*sqrt((1 - n22/women_men[2])/n22 + (1 - n12/women_men[1])/n12)
)

hoger_andpunkt2 <- exp(
  log((n22/ women_men[2])/(n12 / women_men[1])) + qnorm(0.975)*sqrt((1 - n22/women_men[2])/n22 + (1 - n12/women_men[1])/n12)
)
  
(n22/ women_men[2])/(n12 / women_men[1]) 
```

    ## [1] 1.226003

(1.065465, 1.4107311) med konfidensgrad \(0.05\). Vi kan notera att noll
inte ligger på detta intervall. Således är riskkvoten signifikant skild
från noll.

## 1:2
